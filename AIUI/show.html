<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="referrer" content="no-referrer" />
    <link rel="icon" href="images/favicon.ico">

    <title>魔镜 - 上传搭配</title>

    <!-- Bootstrap 4.0-->
    <link rel="stylesheet" href="main/css/bootstrap.css">

    <!-- Bootstrap extend-->
    <link rel="stylesheet" href="main/css/bootstrap-extend.css">

    <!-- Theme style -->
    <link rel="stylesheet" href="main/css/master_style.css">

    <!-- Popup CSS -->
    <link href="assets/vendor_components/Magnific-Popup-master/dist/magnific-popup.css" rel="stylesheet">

    <!-- AIUI Admin skins -->
    <link rel="stylesheet" href="main/css/skins/_all-skins.css">

    <script src="/vue.js"></script>

    <!-- ./wrapper -->

    <!-- jQuery 3 -->
    <script src="assets/vendor_components/jquery-3.3.1/jquery-3.3.1.min.js"></script>

    <!-- popper -->
    <script src="assets/vendor_components/popper/dist/popper.min.js"></script>

    <!-- Bootstrap 4.0-->
    <script src="main/js/bootstrap.js"></script>

    <!-- SlimScroll -->
    <script src="assets/vendor_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <script src="assets/vendor_components/select2/dist/js/select2.full.js"></script>
    <!-- FastClick -->
    <script src="assets/vendor_components/fastclick/lib/fastclick.js"></script>

    <!-- Sparkline -->
    <script src="assets/vendor_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>

    <!-- Magnific popup JavaScript -->
    <script src="assets/vendor_components/Magnific-Popup-master/dist/jquery.magnific-popup.min.js"></script>
    <script src="assets/vendor_components/Magnific-Popup-master/dist/jquery.magnific-popup-init.js"></script>

    <!-- AIUI Admin App -->
    <script src="main/js/template.js"></script>

    <script src="main/js/jquery-cookies.js"></script>
    <script src="main/js/login.js"></script>
    <script src="main/js/items.js"></script>
    <script src="main/js/upload.js"></script>
</head>


<!--<body class="hold-transition skin-black light-sidebar sidebar-mini" onload="load()">-->
<div class="wrapper">

    <header class="main-header">
        <div class="p-10 clearfix float-left logo-block">
            <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                <i class="ti-align-left"></i>
            </a>
            <!-- Logo -->
            <a href="" class="logo">
                <!-- logo-->
                <span class="logo-lg">
                    <!--			  <img src="images/logo-light-text.png" alt="logo" class="light-logo">-->
                    <!--			  <img src="images/logo-dark-text.png" alt="logo" class="dark-logo">-->
                </span>
            </a>
        </div>
        <!-- Header Navbar -->
        <nav class="navbar navbar-static-top">
            <!-- Sidebar toggle button-->
            <div class="ml-10 app-menu">
                <ul class="header-megamenu nav">
                    <li class="btn-group nav-item">
                        <a href="#" class="nav-link rounded" data-toggle="dropdown" aria-expanded="false">
                            <i class="nav-link-icon mdi mdi-view-dashboard text-white mx-5"> </i>
                            Settings
                            <i class="fa fa-angle-down ml-2"></i>
                        </a>
                        <div class="dropdown-menu">
                            <div>
                                <button type="button" onclick="logout()"
                                    class="btn btn-outline btn-flat btn-primary w-p100 text-left no-radius"><i
                                        class="fa fa-folder mr-10"> </i>
                                    登出
                                </button>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>

        </nav>
    </header>

    <!-- Left side column. contains the sidebar -->
    <aside class="main-sidebar">
        <!-- sidebar-->
        <section class="sidebar">
            <!-- Sidebar user panel -->
            <div class="user-panel">
                <div class="image">
                    <img src="images/avatar/2.jpg" class="rounded-circle" alt="User Image">
                </div>
                <div class="info">
                    <h4 id="username"></h4>
                    <a href="#"><i class="fa fa-circle text-success"></i>努力打分...</a>
                </div>
            </div>

            <!-- sidebar menu-->
            <ul class="sidebar-menu" data-widget="tree">
                <li class="treeview">
                    <a href="#">
                        <i class="mdi mdi-view-dashboard"></i> <span>功能添加</span>
                        <span class="pull-right-container">
                            <i class="ti-plus pull-right"></i>
                        </span>
                    </a>
                    <ul class="treeview-menu">
                        <li><a href="category.html"><i class="mdi mdi-resize-bottom-right"></i>展示图片</a></li>
                        <li><a href="items.html"><i class="mdi mdi-resize-bottom-right"></i>搭配推荐</a></li>
                        <li><a href="upload.html"><i class="mdi mdi-resize-bottom-right"></i>上传搭配</a></li>
                        <li><a href="show.html"><i class="mdi mdi-resize-bottom-right"></i>红黑榜</a></li>
                    </ul>
                </li>

            </ul>
        </section>
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <!-- <div class="content-header d-none d-md-block">
              <div class="d-flex align-items-center">
                  <div class="mr-auto">
                      <h3 class="page-title br-0">条件筛选</h3>
                  </div>
              </div>
          </div> -->

        <!-- Main content -->
        <section class="content">
            <div class="col-12">
                <div class="box">
                    <div class="box-header with-border">
                        <h3 class="box-title">搭配红黑榜<span class="text-danger">*</span></h3>
                    </div>
                    <div>
                        <ul class="nav nav-tabs">
                            <li id="redbutton" class="van nav-tabs nav-tabs-bottom nav-link"
                                style="background-color:rgba(200, 0, 20, 0.3);font-size:large;"
                                onclick='switchList("red")'><a href="#red" data-toggle="tab">红榜</a></li>
                            <li id="blackbutton" class="van nav-tabs nav-tabs-bottom nav-link"
                                style="background-color:rgba(220, 220, 220, 0.3);font-size:large;"
                                onclick='switchList("black")'><a href="#black" data-toggle="tab">黑榜</a></li>
                        </ul>
                    </div>
                    <div class="tab-content" id="hot-list">
                        <div class="tab-pane active" id="red">
                            <div class="col-md-10 bg-danger">
                                <h3 class="text-center">红榜</h3>
                                <div>
                                    <div class="d-flex flex-row mb-3" style="margin-top: 20px; margin-bottom:20px;">
                                        <div class="p-1">
                                            <img src="./1.jpg" alt="top" class="img-thumbnail">
                                        </div>
                                        <div class="p-1">
                                            <img src="./2.jpg" alt="bottom" class="img-thumbnail">
                                        </div>
                                        <div>
                                            <div class="caption" style="margin-top: 40px;">
                                                <h3 class="text-center" style=" display:inline; float:left">评级：80</h3>
                                                <button type="button" class="btn btn-info"
                                                    style=" display:inline;  margin-left: 30px;">认证</button>
                                            </div>
                                            <div style="margin-top: 20px;  margin-bottom: 10px;">
                                                <input type="text" style="width:120px; display:inline;"
                                                    class="form-control" placeholder="请输入打分"></input><button
                                                    type="button" class="btn btn-info"
                                                    style="display:inline; margin-left: 20px;">修改分数</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-row mb-3" style="margin-top: 20px; margin-bottom:20px;">
                                        <div class="p-1">
                                            <img src="./1.jpg" alt="top" class="img-thumbnail">
                                        </div>
                                        <div class="p-1">
                                            <img src="./2.jpg" alt="bottom" class="img-thumbnail">
                                        </div>
                                        <div>
                                            <div class="caption" style="margin-top: 40px;">
                                                <h3 class="text-center">评级：80</h3>
                                            </div>
                                            <div style="margin-top: 20px;  margin-bottom: 10px;">
                                                <button type="button" class="btn btn-info"
                                                    style=" display:inline; margin-left: 60px; ">认证</button>
                                                <input type="text"
                                                    style="width: 120px; display:inline; margin-left: 35px; margin-top: 40px;"
                                                    class="form-control" placeholder="请输入打分"></input>
                                                <button type="button" class="btn btn-info"
                                                    style="display:inline; margin-left: 50px; margin-top: 10px;">修改分数</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="black">
                            <div class="col-md-8  bg-dark" id="black">
                                <h3 class="text-center">黑榜</h3>
                                <div style="margin-top: 20px; margin-bottom:20px; border-style:solid;">
                                    <div class="d-flex flex-row mb-4">
                                        <div class="p-1">
                                            <img src="./3.jpg" alt="top" class="img-thumbnail">
                                        </div>
                                        <div class="p-1">
                                            <img src="./4.jpg" alt="bottom" class="img-thumbnail">
                                        </div>
                                    </div>
                                    <div class="caption">
                                        <h3 class="text-center">评级：60</h3>
                                    </div>
                                    <div style="margin-top: 20px;  margin-bottom: 10px;">
                                        <button type="button" class="btn btn-info"
                                            style=" display:inline; margin-left: 20px;">认证</button>
                                        <input type="text" style="width: 120px; display:inline; margin-left: 80px;"
                                            class="form-control" placeholder="请输入打分"></input>
                                        <button type="button" class="btn btn-info"
                                            style="display:inline; margin-left: 20px;">修改分数</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div style="margin-top: 20px;margin-left: 270px;" id="pagdiv">
                    <ul class="pagination" id="pag">
                        <li class="page-first"><a href="#"> 首页</a></li>
                        <li class="page-prev"><a href="#"> 上一页</a></li>
                        <li class="page-num"><a href="#">1</a></li>
                        <li class="page-num"><a href="#">2</a></li>
                        <li class="page-num"><a href="#">3</a></li>
                        <li class="page-next"><a href="#">下一页</a></li>
                        <li class="page-last"><a href="#">末页</a></li>
                    </ul>
                    <div id="pagcon"></div>
                </div>
            </div>


        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <footer class="main-footer">
        &copy; 2021 <a href="https://sse.tongji.edu.cn">TongJi SSE,</a> All Rights Reserved.
    </footer>


    <!-- Add the sidebar's background. This div must be placed immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
</div>



<script type="text/javascript">
    //刷新页面，加载showList()的内容
    $(function () {
        showList("red", 1);
        setIndex(1);
    });

    function switchList(color) {
        if (color == "red") {
            $("#redbutton").css("background-color", "rgba(200, 0, 20, 0.3)");
            $("#blackbutton").css("background-color", "rgba(220, 220, 220, 0.3)");
        }
        else {
            $("#blackbutton").css("background-color", "rgba(20, 150, 200, 0.3)");
            $("#redbutton").css("background-color", "rgba(220, 220, 220, 0.3)");
        }
        showList(color);
        setIndex(1);
    }

    function first() {
        var color = $("#pagdiv").data("color");
        setList(1, color);
        setIndex(1);
    };

    function last() {
        var num = $("#pagdiv").data("sum");
        var color = $("#pagdiv").data("color");
        setIndex(num);
        setList(num, color);
    };

    function prev() {
        var num = $("#pagdiv").data("now") - 1;
        var color = $("#pagdiv").data("color");
        setIndex(num);
        setList(num, color);
    };

    function next() {
        var num = parseInt($("#pagdiv").data("now")) + 1;
        var color = $("#pagdiv").data("color");
        setIndex(num);
        setList(num, color);
    };

    function switchpage(i) {
        var num = i;
        var color = $("#pagdiv").data("color");
        setIndex(num);
        setList(num, color);
    };

    function jumppage() {
        var num = $("#jump").val();
        if (isNaN(num)) {
            return;
        }
        var color = $("#pagdiv").data("color");
        setList(num, color);
        setIndex(num);
    }

    function setIndex(i) {
        var last = $("#pagdiv").data("sum");
        if (i <= 0 || i > last) {
            return;
        }
        $("#pag").empty();
        if (i > 1 && i < last) {
            var div = '<li class="page-first" onclick="first()"><a href="#"> 首页</a></li> ' +
                '<li class="page-prev" onclick="prev()"><a href="#"> 上一页</a></li> ' +
                '<li class="page-num" onclick="prev()"><a href="#">' + String(i - 1) + '</a></li> ' +
                '<li class="page-num"><a href="#">' + i + '</a></li> ' +
                '<li class="page-num" onclick="next()"><a href="#">' + String(parseInt(i) + 1) + '</a></li> ' +
                '<li class="page-next" onclick="next()"><a href="#">下一页</a></li> ' +
                '<li class="page-last" onclick="last()"><a href="#">末页</a></li>';
            $("#pag").append(div);
        }
        else if (i == 1) {
            var div = '<li class="page-first" onclick="first()"><a href="#"> 首页</a></li> ' +
                '<li class="page-prev" onclick="prev()"><a href="#"> 上一页</a></li> ' +
                '<li class="page-num"><a href="#">1</a></li> ' +
                '<li class="page-num" onclick="switchpage(2)"><a href="#">2</a></li> ' +
                '<li class="page-num" onclick="switchpage(3)"><a href="#">3</a></li> ' +
                '<li class="page-next"  onclick="next()"><a href="#">下一页</a></li> ' +
                '<li class="page-last"  onclick="last()"><a href="#">末页</a></li>';
            $("#pag").append(div);
        }
        else {
            var div = '<li class="page-first" onclick="first()"><a href="#"> 首页</a></li> ' +
                '<li class="page-prev" onclick="prev()"><a href="#"> 上一页</a></li> ' +
                '<li class="page-num" onclick="switchpage(' + String(i - 2) + ')"><a href="#">' + String(i - 2) + '</a></li> ' +
                '<li class="page-num" onclick="switchpage(' + String(i - 1) + ')"><a href="#">' + String(i - 1) + '</a></li> ' +
                '<li class="page-num"><a href="#">' + i + '</a></li> ' +
                '<li class="page-next" onclick="next()"><a href="#">下一页</a></li> ' +
                '<li class="page-last" onclick="last()"><a href="#">末页</a></li>';
            $("#pag").append(div);
        }
        $("#pagdiv").data("now", i);
        $("#pagdiv").data("sum", last);
        var div1 = '<p style="display:inline; margin-left: 100px; ">跳转至第</p>'
            + '<input id="jump" class="text" style="display:inline; width:30px"></input>'
            + '<p style="display:inline; margin-left:1px">页</p>'
            + '<button type="button" class="btn btn-primary" onclick="jumppage()" style="display:inline; margin-left:2px; padding-top:0px; padding-left:10px; width:40px; height:27px">go</button>'
            + '<p style="display:inline; margin-left: 30px;">第' + i + '页/共'
            + last
            + '页</p>';
        $("#pagcon").html(div1);
    }
    function setList(i, type) {
        var last = $("#pagdiv").data("sum");
        if (i <= 0 || i > last) {
            return;
        }
        $("#pagdiv").data("color", type);
        $("#hot-list").empty();
        $.ajax({
            "url": "http://47.102.43.156:8002/api/search/new_rblist/" + i,
            "data": JSON.stringify({
                "rb_type": type
            }),
            "contentType": 'application/json',
            "type": "post",
            "success": function (ret) {
                ret = ret.replaceAll('ObjectId(', '')
                ret = ret.replaceAll(')', '')
                ret = ret.replaceAll('\'', '"')
                ret = ret.replaceAll(', "record": None', '') //??
                ret = ret.replaceAll(', "user_id": None', '') //??
                ret = ret.replaceAll(', "bottom": None', '') //??
                ret = ret.replaceAll(', "top": None', '') //??
                var data = JSON.parse(ret)
                for (var i = 0; i < data.length; i++) {
                    if (("bottom" in data[i] == false) || ("top" in data[i] == false)) {
                        continue;
                    }
                    var div;
                    if ("new_record" in data[i]) {
                        div = '<div ' +
                            'id= #{id} ' +
                            'class="d-flex flex-row mb-3" style="margin-top: 20px; margin-bottom:20px; border-style: solid; border-color: rgb(150, 150, 150);">' +
                            '<div class="col-3" style="border-style: solid; border-color: rgb(200,200,200); border: 1px solid #dee2e6; border-radius: 0.25rem; margin: 5px; width: 270px; text-align:center">' +
                            '<div class="fx-element-overlay" style="position: relative; top:50%; transform:translateY(-50%);">' +
                            '<div class="fx-card-item">' +
                            '<div class="fx-card-avatar fx-overlay-1">' +
                            '<img src= #{topimg} alt="top">' +
                            '<div class="fx-overlay scrl-dwn">' +
                            '<ul class="fx-info">' +
                            '<li><a id="topli#{id}" class="btn default btn-outline image-popup-vertical-fit" href="#{topimg}"><i class="ion-search"></i></a></li>' +
                            '<li><a class="btn default btn-outline" onclick="deleteItem(\'#{id}\')"><i class="fa fa-warning"></i></a></li>' +
                            '</ul>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-3" style="border-style: solid; border-color: rgb(200,200,200); border: 1px solid #dee2e6; border-radius: 0.25rem; margin: 5px; width: 270px; text-align:center">' +
                            '<div class="fx-element-overlay" style="position: relative; top:50%; transform:translateY(-50%);">' +
                            '<div class="fx-card-item">' +
                            '<div class="fx-card-avatar fx-overlay-1">' +
                            '<img src= #{bottomimg} alt="bottom">' +
                            '<div class="fx-overlay scrl-dwn">' +
                            '<ul class="fx-info">' +
                            '<li><a id="bottomli#{id}" class="btn default btn-outline image-popup-vertical-fit" href="#{bottomimg}"><i class="ion-search"></i></a></li>' +
                            '<li><a class="btn default btn-outline" onclick="deleteItem(\'#{id}\')"><i class="fa fa-warning"></i></a></li>' +
                            '</ul>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div>' +
                            '<div class="caption" style="margin-top: 70px; margin-left: 10px">' +
                            '<button id="#{id}div1" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">场景：#{scenario}</button>' +
                            '<button id="#{id}div2" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">原始打分：#{score}</button>' +
                            '<button id="#{id}div3" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">模型预测分数：#{rec}</button>' +
                            '</div>' +
                            '<div style="margin-top: 60px; margin-left: 30px">' +
                            '<button id="#{id}div4" type="button" class="btn btn-info btn-rounded" disabled="true" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',0)" ' +
                            'style=" margin-left: 10px;">不满意</button>' +
                            '<button id="#{id}div5" type="button" class="btn btn-success btn-rounded" disabled="true" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',1)" ' +
                            'style=" margin-left: 10px;">无感</button>' +
                            '<button id="#{id}div6" type="button" class="btn btn-warning btn-rounded" disabled="true" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',2)" ' +
                            'style=" margin-left: 10px;">满意</button>' +
                            '</div>' +
                            '</div>' +
                            '</div>'
                    }
                    else {
                        div = '<div ' +
                            'id= #{id} ' +
                            'class="d-flex flex-row mb-3" style="margin-top: 20px; margin-bottom:20px; border-style: solid; border-color: rgb(150, 150, 150);">' +
                            '<div class="col-3" style="border-style: solid; border-color: rgb(200,200,200); border: 1px solid #dee2e6; border-radius: 0.25rem; margin: 5px; width: 270px; text-align:center">' +
                            '<div class="fx-element-overlay" style="position: relative; top:50%; transform:translateY(-50%);">' +
                            '<div class="fx-card-item">' +
                            '<div class="fx-card-avatar fx-overlay-1">' +
                            '<img src= #{topimg} alt="top">' +
                            '<div class="fx-overlay scrl-dwn">' +
                            '<ul class="fx-info">' +
                            '<li><a id="topli#{id}" class="btn default btn-outline image-popup-vertical-fit" href="#{topimg}"><i class="ion-search"></i></a></li>' +
                            '<li><a class="btn default btn-outline" onclick="deleteItem(\'#{id}\')"><i class="fa fa-warning"></i></a></li>' +
                            '</ul>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-3" style="border-style: solid; border-color: rgb(200,200,200); border: 1px solid #dee2e6; border-radius: 0.25rem; margin: 5px; width: 270px; text-align:center">' +
                            '<div class="fx-element-overlay" style="position: relative; top:50%; transform:translateY(-50%);">' +
                            '<div class="fx-card-item">' +
                            '<div class="fx-card-avatar fx-overlay-1">' +
                            '<img src= #{bottomimg} alt="bottom">' +
                            '<div class="fx-overlay scrl-dwn">' +
                            '<ul class="fx-info">' +
                            '<li><a id="bottomli#{id}" class="btn default btn-outline image-popup-vertical-fit" href="#{bottomimg}"><i class="ion-search"></i></a></li>' +
                            '<li><a class="btn default btn-outline" onclick="deleteItem(\'#{id}\')"><i class="fa fa-warning"></i></a></li>' +
                            '</ul>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div>' +
                            '<div class="caption" style="margin-top: 70px; margin-left: 10px">' +
                            '<button id="#{id}div1" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">场景：#{scenario}</button>' +
                            '<button id="#{id}div2" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">原始打分：#{score}</button>' +
                            '<button id="#{id}div3" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">模型预测分数：#{rec}</button>' +
                            '</div>' +
                            '<div style="margin-top: 60px; margin-left: 30px">' +
                            '<button id="#{id}div4" type="button" class="btn btn-info btn-rounded" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',0)" ' +
                            'style=" margin-left: 10px;">不满意</button>' +
                            '<button id="#{id}div5" type="button" class="btn btn-success btn-rounded" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',1)" ' +
                            'style=" margin-left: 10px;">无感</button>' +
                            '<button id="#{id}div6" type="button" class="btn btn-warning btn-rounded" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',2)" ' +
                            'style=" margin-left: 10px;">满意</button>' +
                            '</div>' +
                            '</div>' +
                            '</div>'
                    }
                    div = div.replaceAll('#{id}', data[i]._id);
                    div = div.replaceAll('#{score}', data[i].score[0]);
                    div = div.replaceAll('#{scenario}', data[i].scenario[0]);
                    div = div.replaceAll('#{rec}', data[i].recommend_index.toFixed(0));
                    top_path = data[i].top.image_path
                    bottom_path = data[i].bottom.image_path
                    top_path.replaceAll('&eacute;', 'e')
                    bottom_path.replaceAll('&eacute;', 'e')
                    div = div.replace('#{topimg}', "images/df_bbox/" + top_path);
                    div = div.replace('#{bottomimg}', "images/df_bbox/" + bottom_path);
                    $("#hot-list").append(div);
                }
            }
        });
    }
    //动态显示内容
    function showList(color) {
        localStorage.clear();
        getIndex(color);
        $("#pagdiv").data("color", color);
        $("#hot-list").empty();//显示前清空原列表
        $.ajax({
            "url": "http://47.102.43.156:8002/api/search/new_rblist/1",
            "data": JSON.stringify({
                "rb_type": color
            }),
            "contentType": 'application/json',
            "type": "post",//请求方式
            "success": function (ret) {
                ret = ret.replaceAll('ObjectId(', '')
                ret = ret.replaceAll(')', '')
                ret = ret.replaceAll('\'', '"')
                ret = ret.replaceAll(', "record": None', '') //??
                ret = ret.replaceAll(', "user_id": None', '') //??
                ret = ret.replaceAll(', "bottom": None', '') //??
                ret = ret.replaceAll(', "top": None', '') //??
                var data = JSON.parse(ret)
                for (var i = 0; i < data.length; i++) {
                    if (("bottom" in data[i] == false) || ("top" in data[i] == false)) {
                        continue;
                    }
                    var div;
                    if ("new_record" in data[i]) {
                        div = '<div ' +
                            'id= #{id} ' +
                            'class="d-flex flex-row mb-3" style="margin-top: 20px; margin-bottom:20px; border-style: solid; border-color: rgb(150, 150, 150);">' +
                            '<div class="col-3" style="border-style: solid; border-color: rgb(200,200,200); border: 1px solid #dee2e6; border-radius: 0.25rem; margin: 5px; width: 270px; text-align:center">' +
                            '<div class="fx-element-overlay" style="position: relative; top:50%; transform:translateY(-50%);">' +
                            '<div class="fx-card-item">' +
                            '<div class="fx-card-avatar fx-overlay-1">' +
                            '<img src= #{topimg} alt="top">' +
                            '<div class="fx-overlay scrl-dwn">' +
                            '<ul class="fx-info">' +
                            '<li><a id="topli#{id}" class="btn default btn-outline image-popup-vertical-fit" href="#{topimg}"><i class="ion-search"></i></a></li>' +
                            '<li><a class="btn default btn-outline" onclick="deleteItem(\'#{id}\')"><i class="fa fa-warning"></i></a></li>' +
                            '</ul>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-3" style="border-style: solid; border-color: rgb(200,200,200); border: 1px solid #dee2e6; border-radius: 0.25rem; margin: 5px; width: 270px; text-align:center">' +
                            '<div class="fx-element-overlay" style="position: relative; top:50%; transform:translateY(-50%);">' +
                            '<div class="fx-card-item">' +
                            '<div class="fx-card-avatar fx-overlay-1">' +
                            '<img src= #{bottomimg} alt="bottom">' +
                            '<div class="fx-overlay scrl-dwn">' +
                            '<ul class="fx-info">' +
                            '<li><a id="bottomli#{id}" class="btn default btn-outline image-popup-vertical-fit" href="#{bottomimg}"><i class="ion-search"></i></a></li>' +
                            '<li><a class="btn default btn-outline" onclick="deleteItem(\'#{id}\')"><i class="fa fa-warning"></i></a></li>' +
                            '</ul>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div>' +
                            '<div class="caption" style="margin-top: 70px; margin-left: 10px">' +
                            '<button id="#{id}div1" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">场景：#{scenario}</button>' +
                            '<button id="#{id}div2" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">原始打分：#{score}</button>' +
                            '<button id="#{id}div3" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">模型预测分数：#{rec}</button>' +
                            '</div>' +
                            '<div style="margin-top: 60px; margin-left: 30px">' +
                            '<button id="#{id}div4" type="button" class="btn btn-info btn-rounded" disabled="true" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',0)" ' +
                            'style=" margin-left: 10px;">不满意</button>' +
                            '<button id="#{id}div5" type="button" class="btn btn-success btn-rounded" disabled="true" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',1)" ' +
                            'style=" margin-left: 10px;">无感</button>' +
                            '<button id="#{id}div6" type="button" class="btn btn-warning btn-rounded" disabled="true" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',2)" ' +
                            'style=" margin-left: 10px;">满意</button>' +
                            '</div>' +
                            '</div>' +
                            '</div>'
                    }
                    else {
                        div = '<div ' +
                            'id= #{id} ' +
                            'class="d-flex flex-row mb-3" style="margin-top: 20px; margin-bottom:20px; border-style: solid; border-color: rgb(150, 150, 150);">' +
                            '<div class="col-3" style="border-style: solid; border-color: rgb(200,200,200); border: 1px solid #dee2e6; border-radius: 0.25rem; margin: 5px; width: 270px; text-align:center">' +
                            '<div class="fx-element-overlay" style="position: relative; top:50%; transform:translateY(-50%);">' +
                            '<div class="fx-card-item">' +
                            '<div class="fx-card-avatar fx-overlay-1">' +
                            '<img src= #{topimg} alt="top">' +
                            '<div class="fx-overlay scrl-dwn">' +
                            '<ul class="fx-info">' +
                            '<li><a id="topli#{id}" class="btn default btn-outline image-popup-vertical-fit" href="#{topimg}"><i class="ion-search"></i></a></li>' +
                            '<li><a class="btn default btn-outline" onclick="deleteItem(\'#{id}\')"><i class="fa fa-warning"></i></a></li>' +
                            '</ul>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-3" style="border-style: solid; border-color: rgb(200,200,200); border: 1px solid #dee2e6; border-radius: 0.25rem; margin: 5px; width: 270px; text-align:center">' +
                            '<div class="fx-element-overlay" style="position: relative; top:50%; transform:translateY(-50%);">' +
                            '<div class="fx-card-item">' +
                            '<div class="fx-card-avatar fx-overlay-1">' +
                            '<img src= #{bottomimg} alt="bottom">' +
                            '<div class="fx-overlay scrl-dwn">' +
                            '<ul class="fx-info">' +
                            '<li><a id="bottomli#{id}" class="btn default btn-outline image-popup-vertical-fit" href="#{bottomimg}"><i class="ion-search"></i></a></li>' +
                            '<li><a class="btn default btn-outline" onclick="deleteItem(\'#{id}\')"><i class="fa fa-warning"></i></a></li>' +
                            '</ul>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div>' +
                            '<div class="caption" style="margin-top: 70px; margin-left: 10px">' +
                            '<button id="#{id}div1" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">场景：#{scenario}</button>' +
                            '<button id="#{id}div2" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">原始打分：#{score}</button>' +
                            '<button id="#{id}div3" class="btn btn-default" disabled="true" style="display:inline; padding-left:5px; padding-right:5px; margin-left:20px">模型预测分数：#{rec}</button>' +
                            '</div>' +
                            '<div style="margin-top: 60px; margin-left: 30px">' +
                            '<button id="#{id}div4" type="button" class="btn btn-info btn-rounded" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',0)" ' +
                            'style=" margin-left: 10px;">不满意</button>' +
                            '<button id="#{id}div5" type="button" class="btn btn-success btn-rounded" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',1)" ' +
                            'style=" margin-left: 10px;">无感</button>' +
                            '<button id="#{id}div6" type="button" class="btn btn-warning btn-rounded" style="display:inline; margin-left: 40px;" onclick="setRecord(\'' + String(data[i]._id) + '\',2)" ' +
                            'style=" margin-left: 10px;">满意</button>' +
                            '</div>' +
                            '</div>' +
                            '</div>'
                    }
                    div = div.replaceAll('#{id}', data[i]._id);
                    div = div.replaceAll('#{score}', data[i].score[0]);
                    div = div.replaceAll('#{scenario}', data[i].scenario[0]);
                    div = div.replaceAll('#{rec}', data[i].recommend_index.toFixed(0));
                    top_path = data[i].top.image_path
                    bottom_path = data[i].bottom.image_path
                    top_path.replaceAll('&eacute;', 'e')
                    bottom_path.replaceAll('&eacute;', 'e')
                    div = div.replace('#{topimg}', "images/df_bbox/" + top_path);
                    div = div.replace('#{bottomimg}', "images/df_bbox/" + bottom_path);
                    $("#hot-list").append(div);
                }
            },
            "error": function (err) {
                console.log('失败', err);
            }
        });
    }

    function getIndex(color) {
        $.ajax({
            "url": "http://47.102.43.156:8002/api/search/rblist_pages",
            "type": "post",//请求方式
            "data": JSON.stringify({
                "rb_type": color
            }),
            "contentType": 'application/json',
            "success": function (ret) {
                var data = JSON.parse(ret)
                $("#pagdiv").data("now", "1");
                $("#pagdiv").data("sum", data);
                var div = '<p style="display:inline; margin-left: 100px; ">跳转至第</p>'
                    + '<input id="jump" class="text" style="display:inline; width:30px"></input>'
                    + '<p style="display:inline; margin-left:1px">页</p>'
                    + '<button type="button" class="btn btn-primary" onclick="jumppage()" style="display:inline; margin-left:2px; padding-top:0px; padding-left:10px; width:40px; height:27px">go</button>'
                    + '<p style="display:inline; margin-left: 30px;">第1页/共'
                    + data
                    + '页</p>';
                $("#pagcon").html(div);
            },
            error: function (err) {
                console.log('失败', err);
            }
        });
    }

    function setRecord(id, eva1) {
        var uid = $.cookie('userid');
        var eva = eva1;
        var time = Date.parse(new Date());
        $.ajax({
            "url": "http://47.102.43.156:8002/api/update/set_record",
            "type": "post",
            "data": JSON.stringify({
                "data": {
                    "_id": id,
                    "new_record": {
                        "user_id": uid,
                        "evaluation": eva,
                        "timestamp": time
                    }
                }
            }),
            "contentType": 'application/json',
            "success": function (ret) {
                //alert("修改成功");
                $("#" + id + "div4").attr("disabled", true);
                $("#" + id + "div5").attr("disabled", true);
                $("#" + id + "div6").attr("disabled", true);
            },
            error: function (err) {
                console.log('失败', err);
            }
        });
    }

    function deleteItem(id) {
        $.ajax({
            url: "http://47.102.43.156:8002/api/delete/collocation", //api/delete
            contentType: 'application/json',
            type: 'post',
            data: JSON.stringify(
                {
                    '_id': id
                }
            ),
            success: function (data) {
                console.log('deleteItem: ', data);
                $("#" + id + "div2").attr("disabled", true);
                $("#input" + id).attr("disabled", true);
                $("#" + id + "div3").attr("disabled", true);
                $("#" + id + "div2").text("已报错");
                $("#input" + id).val("");
            },
            error: function (err) {
                console.log('失败', err);
            }
        })
    }
</script>


</body>

</html>